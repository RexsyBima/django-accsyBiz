{% extends "base.html" %}
{% block content %}
    <div class="container mx-auto p-6">
        {% if messages %}
            <ul class="mb-4">
                {% for message in messages %}
                    <li class="p-2 rounded {{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        <h1 class="text-3xl font-bold mb-6">{{ place.name }}</h1>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <p><span class="font-medium">Legal Name:</span> {{ place.legal_name|default:"N/A" }}</p>
                <p><span class="font-medium">Business Activity:</span> {{ place.business_category|default:"N/A" }}</p>
                <p><span class="font-medium">Address:</span> {{ place.address|default:"N/A" }}</p>
                <p><span class="font-medium">City:</span> {{ place.city }}</p>
                <p><span class="font-medium">State:</span> {{ place.state }}</p>
                <p><span class="font-medium">ZIP Code:</span> {{ place.zip_code|default:"N/A" }}</p>
                <p><span class="font-medium">Category:</span> {{ place.category|default:"N/A" }}</p>
                <p><span class="font-medium">License Status:</span> {{ place.license_status|default:"N/A" }}</p>
            </div>
            <div class="space-y-4">
                {% if place.latitude and place.longitude %}
                    <p><span class="font-medium">Latitude:</span> {{ place.latitude }}</p>
                    <p><span class="font-medium">Longitude:</span> {{ place.longitude }}</p>
                {% endif %}
                <p><span class="font-medium">Neighborhood:</span> {{ place.neighborhood|default:"N/A" }}</p>
                <p><span class="font-medium">Community Area:</span> {{ place.community_area_name|default:"N/A" }}</p>
            </div>
        </div>
        <div class="mt-6 space-y-4">
            <div>
                <h2 class="text-2xl font-bold mb-4">Verified Features</h2>
            </div>
            {% for feature in features %}
                <p class="p-4 bg-gray-100 rounded">{{ feature.feature.label }}</p>
            {% endfor %}
        </div>
        <div class="mt-6 space-y-6">
            <div>
                <h2 class="text-2xl font-bold mb-4">Features Submission</h2>
            </div>
            {% for feature in features_posts %}
                <div class="p-4 bg-gray-100 rounded">
                    <p class="font-medium">{{ feature.user }} says:</p>
                    <p>{{ feature.feature }}</p>
                    <p>{{ feature.body_data|safe }}</p>
                    <p class="italic">Total votes: {{ feature.votes.count }}</p>
                    <form method="POST" action="{% url 'handle_vote' place.id %}?feature_id={{ feature.id }}" class="mt-2 flex space-x-2">
                        {% csrf_token %}
                        <button type="submit" name="vote" value="upvote" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Upvote</button>
                        <button type="submit" name="vote" value="downvote" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Downvote</button>
                    </form>
                </div>
            {% endfor %}
        </div>
        <div class="mt-6 space-y-4" id="comment-list">
            <div>
                <h2 class="text-2xl font-bold mb-4">Comments</h2>
            </div>
            {% for comment in comments %}
                <div class="p-4 bg-gray-50 rounded">
                <b>User {{ comment.user }} says..</b>
                    <div>
                        {{ comment.body|safe }}
                    </div>
                {% if user == comment.user %}
                <form method="POST" action="{% url 'delete_comment' comment.id %}?placeid={{ place.id }}" class="mt-2 flex space-x-2">
                    {% csrf_token %}
                    <button type="submit" name="vote" value="upvote" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Delete Comment</button>
                </form>
                {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="mt-6 space-x-4">
            <a href="{% url 'comment_form' place.id %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Post Comment Here</a>
            <a href="{% url 'feature_form' place.id %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Post Feature Here</a>
        </div>
    </div>
{% endblock content %}

